"use strict";const e=require("../../../common/vendor.js"),t={components:{navBar:()=>"../../../components/navBar/navBar.js"},data:()=>({Text:"照片和名字",placeholderText:"#cea697",inputValue:"",imageSrc:"",nickName:"",headerUrl:"",host:"",signature:"",ossAccessKeyId:"",policy:"",key:"",securityToken:""}),computed:{isActive(){return""!==this.inputValue.trim()}},onLoad(){},methods:{nextpage(){this.isActive&&(e.wx$1.setStorageSync("petName",this.inputValue),e.index.navigateTo({url:"/pages/IDCreate/IDCreate2/IDCreate2"}))},chooseImage(){const t=this;e.index.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:async a=>{this.imageSrc=a.tempFilePaths[0];try{const t=await e.index.request({url:"http://43.140.198.154:88/thirdParty/getUploadSignature/",method:"GET",header:{Authorization:"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJvcGVuaWQiOiJvdVZjVzQwdGZzcmlmM3ZzQ3pmRjdFcjRqTm04Iiwic2Vzc2lvbl9rZXkiOiJYQitLTUhncTVaZXRjTktsSE1mOEJnPT0iLCJleHAiOjE2Nzk5MTgyMDV9.6VI_tg8bjN06KEV3uFmTTU3kDxyy_INGeNjTWbsaMpY"}});console.log(t),this.host=t.data.data.host,this.signature=t.data.data.signature,this.ossAccessKeyId=t.data.data.ossAccessKeyId,this.policy=t.data.data.policy,this.securityToken=t.data.data.securityToken}catch(c){console.log("请求签名失败",c)}const s=a.tempFilePaths[0],o=new Date,i=`${`${o.getFullYear()}-${(o.getMonth()+1).toString().padStart(2,"0")}-${o.getDate().toString().padStart(2,"0")}`}/xxx.jpg`;console.log(t.host+i),e.index.uploadFile({url:t.host,filePath:s,name:"file",formData:{key:i,policy:t.policy,OSSAccessKeyId:t.ossAccessKeyId,signature:t.signature},success:e=>{console.log(e),204===a.statusCode&&console.log("上传成功"),console.log(111)},fail:function(e){console.log(t.filePath)}})}})},getUserOpenId(t){e.index.login({provider:"weixin",success(e){e.code,console.log(e)}})},login(){var t=this;e.index.showModal({mask:!0,title:"温馨提示",content:"授权微信登录后才能正常使用",success(a){a.confirm?e.index.getUserProfile({desc:"获取您的昵称、头像",success:a=>{if("getUserProfile:ok"==a.errMsg&&null!=a.userInfo){var s={avatarUrl:a.userInfo.avatarUrl,nickName:a.userInfo.nickName};t.nickName=a.userInfo.nickName,t.headerUrl=a.userInfo.avatarUrl,t.getUserOpenId(s),console.log(t.nickName)}else e.index.showToast({icon:"none",title:"获取失败"})},fail:e=>{}}):a.cancel}})}}};if(!Array){e.resolveComponent("nav-bar")()}const a=e._export_sfc(t,[["render",function(t,a,s,o,i,c){return{a:e.p({text:i.Text}),b:i.imageSrc?i.imageSrc:"/static/IDCreate/picture&name/camera.png",c:e.o(((...e)=>c.chooseImage&&c.chooseImage(...e))),d:i.inputValue,e:e.o((e=>i.inputValue=e.detail.value)),f:c.isActive?1:"",g:e.o(((...e)=>c.nextpage&&c.nextpage(...e)))}}],["__scopeId","data-v-a5f6ab28"]]);wx.createPage(a);
